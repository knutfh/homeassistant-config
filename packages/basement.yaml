########################################
#  BASEMENT
########################################

light:
  platform: switch
  name: Kjeller gulvlampe
  entity_id: switch.kjeller_gulvlampe

timer:
  basement_light_turnoff:
    name: Time remaining
    duration: 600

automation:
  - id: basement_turn_off_light_delay
    alias: 'Basement: Turn off light delay'
    trigger:
    - platform: state
      entity_id:  binary_sensor.bevegelse_kjellerstue
      from: 'on'
      to: 'off'
    action:
    - service: timer.start
      data:
        entity_id: timer.basement_light_turnoff
      
  - id: basement_turn_off_light
    alias: 'Basement: Turn off light'
    trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.basement_light_turnoff
    action:
    - service: light.turn_off
      data:
        entity_id: light.alt_lys_kjeller
      
  - id: basement_turn_on_light
    alias: 'Basement: Turn on light'
    trigger:
    - platform: state
      entity_id:  binary_sensor.bevegelse_kjellerstue
      from: 'off'
      to: 'on'
    action:
    - service: light.turn_on
      data:
        entity_id: light.alt_lys_kjeller
    - service: timer.cancel
      data:
        entity_id: timer.basement_light_turnoff

  - id: basement_toggle_light_single_click
    alias: 'Basement: Toggle light on single click'
    trigger:
    - platform: event
      event_type: deconz_event
      event_data:
        id: 'kjeller'
        event: 1002
    action:
    - service: light.toggle
      entity_id: light.alt_lys_kjeller
    - service: automation.turn_off
      entity_id: 
        - automation.basement_turn_on_light
        - automation.basement_turn_off_light
        - automation.basement_turn_off_light_delay

  - id: basement_light_on_double_click
    alias: 'Basement: Activate light automation double click'
    trigger:
      - platform: event
        event_type: deconz_event
        event_data:
          id: 'kjeller'
          event: 1004
    action:
      - service: automation.turn_on
        entity_id:
          - automation.basement_turn_off_light
          - automation.basement_turn_off_light_delay
          - automation.basement_turn_on_light
      - service: automation.trigger
        entity_id: automation.basement_turn_off_light


