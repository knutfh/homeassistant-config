########################################
### TABLETÂ PACKAGE
########################################

### Control
rest_command:
  kiosk_command:
    url: !secret tablet_rest_url


light:
  - platform: template
    lights:
      tablet_backlight:
        friendly_name: Tablet Backlight
        value_template: '{{ states.sensor.kiosk_device_info.attributes["isScreenOn"] }}'
        level_template: '{{ states.sensor.kiosk_device_info.attributes["screenBrightness"] }}'
        turn_on:
          service: rest_command.kiosk_command
          data:
            cmd: screenOn
        turn_off:
          service: rest_command.kiosk_command
          data:
            cmd: screenOff
        set_level:
          service: rest_command.kiosk_command
          data_template:
            cmd: setStringSetting
            key: screenBrightness
            value: '{{ brightness }}'


### Automations
automation:
  - id: tablet_reduce_brightness_at_night
    alias: Reduce tablet brightness at night
    trigger:
      - platform: state
        entity_id: input_select.house_mode
        to: Kveld 
    action: 
      service: light.turn_on
      data_template: 
        entity_id: light.tablet_backlight
        brightness_pct: 20

  - id: tablet_increase_brightness_morning
    alias: Increase tablet brightness in the morning
    trigger:
      - platform: state
        entity_id: input_select.house_mode
        to: Morgen 
    action: 
      service: light.turn_on
      data_template: 
        entity_id: light.tablet_backlight
        brightness_pct: 80



### Sensors
sensor:
  - platform: rest
    name: tablet_rest
    json_attributes:
      - batteryLevel
      - kioskMode
      - screenBrightness
      - motionDetectorState
      - maintenanceMode
      - hostname4
      - ip4
      - mac
      - startUrl
      - currentPage
    resource: !secret tablet_rest_info_url
    value_template: '{{ value_json.isScreenOn }}'

switch:
  - platform: rfxtrx
    devices:
      0b11000512bc0cfe08010f70:
        name: TabletPowerSwitch
        fire_event: true